#include <Arduino.h>
#include <Wire.h>
#include <TinyGPSplusplus.h>  //gps lib
#include <ReceiveOnlySoftwareSerial.h>
#include <INA219.h>
#include <EEPROM.h> 
#include <CN0349.h>
#include <avr/io.h> 
#include <avr/sleep.h>
#include <avr/wdt.h>
#include <avr/power.h>


void startup(void){
  init();
  pinMode(22, OUTPUT); 
  digitalWrite(22,HIGH); //LED on
  pinMode(8, OUTPUT); 
  digitalWrite(8,HIGH); //Sensors on
 
}
	//This function is used to initialize the USART
//at a given UBRR value
void USARTInit(uint16_t ubrr_value){

   //Set Baud rate
   UBRR0L = ubrr_value;
   UBRR0H = (ubrr_value>>8);

   /*Set Frame Format
   >> Asynchronous mode
   >> No Parity
   >> 1 StopBit
   >> char size 8
   */
   UCSR0C = (3<<UCSZ00); // Asynchronous 8 N 1

   //Enable The receiver and transmitter
   UCSR0B=(1<<RXEN0)|(1<<TXEN0);

}


//This function is used to read the available data
//from USART. This function will wait untill data is
//available.
char USARTReadChar(){
   //Wait untill a data is available

   while(!(UCSR0A & (1<<RXC0))){
      //Do nothing
   }

   //Now USART has got data from host
   //and is available is buffer
   return UDR0;
}


//This fuction writes the given "data" to
//the USART which then transmit it via TX line
void USARTWriteChar(char data){
   
   //Wait untill the transmitter is ready
   while(!(UCSR0A & (1<<UDRE0))){
      //Do nothing
   }

   //Now write the data to USART buffer
   UDR0=data;
}

int main(){
 startup();
   //Variable Declaration
   char data;

   /*First Initialize the USART with baud rate = 19200bps
   for Baud rate = 19200bps
   UBRR value = 51
   */
   USARTInit(51);    //UBRR = 51

   //Loop forever
   while(1){
   
      //Read data
      //data=USARTReadChar();
	  data='A';

      //USARTWriteChar(data);
	  USARTWriteChar('A');
	  USARTWriteChar('B');
	  USARTWriteChar('R');
	  USARTWriteChar('A');
	  USARTWriteChar('A');
	  USARTWriteChar('O');
	  USARTWriteChar('F');
	  USARTWriteChar('M');
	  USARTWriteChar('T');
	  USARTWriteChar('\r');
	  USARTWriteChar('\n');

   }

   return(0);

}