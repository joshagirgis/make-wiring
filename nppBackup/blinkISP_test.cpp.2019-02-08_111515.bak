#include <Arduino.h>
#include <Wire.h>
#include <TinyGPSplusplus.h>  //gps lib
#include <ReceiveOnlySoftwareSerial.h>
#include <INA219.h>
#include <EEPROM.h> 
#include <CN0349.h>
//#include <NLSWDK.h>
#include <SHT20.h>
#include <avr/io.h> 
#include <avr/sleep.h>
#include <avr/wdt.h>
#include <avr/power.h>
#include <avr/interrupt.h>
#include <util/delay.h>
#include <stdlib.h>
#define Debug Serial //define Serial ports for Arduino Mega
#define SW_Serial Serial1  //wire pins to serial port 3 
#define SW_ON LOW
ReceiveOnlySoftwareSerial gpsSer(6); 	// RX PB2 converts to pin6 in for atmega644pa Arduino variant
TinyGPSPlus gps; 						//intialize GPS
SHT20 TH;
INA219 CV;



int main(){
	init();
	Wire.begin();
	Serial.begin(115200);
	Serial.println("Begin!");	
	
	DDRD |= 1 << PIND4;  								//LED ->set Port D -> PD4 to OUTPUT without changing current settings
	PORTD |= 1 << PIND4; 								//FLIP onboard LED ON

	DDRD |= 1 << PIND6;  								//set Port D -> PD6 to OUTPUT without changing current settings
	PORTD |= 1 << PIND6; 								//SET PD6 to HIGH -> turns ON onboard 4 Volt and 3.3v volt Regulators

	
	/*gpsSer.begin(9600);
	CV.begin(0x41);										// Default INA219 address is 0x40 JP2 bridged = 0x41
	CV.configure(INA219_RANGE_32V, INA219_GAIN_320MV, INA219_BUS_RES_12BIT, INA219_SHUNT_RES_12BIT_1S);
	CV.calibrate(0.1, 2);								// Calibrate INA219. Rshunt = 0.1 ohm, Max excepted current = 2A
	//*/
	
	modemSetup();
	while (1){
		delay(200);
		getExoData("freqe", "0a2a70e7069f0481fb23bc3a72ba5c9a5edad4a3");
		delay(8000);
		
	
	/*	float temp = TH.readTemperature(); 				//Read Temperature
		float humid = TH.readHumidity();   				//Read Humiditiy
		Serial.print("Board Temperature:   ";				//Print Power stats
		Serial.println(temp, 1); 
		Serial.print("Humidity:   ";				//Print Power stats
		Serial.println(humid, 1);  						//Print Temperature and Humidity
		Serial.println(gpsSensor());					//Print GPS location
		Serial.print("Source voltage:   ";				//Print Power stats
		Serial.print(CV.readBusVoltage(), 5);
		Serial.println(" V";	

		Serial.print("Power Consumption:     ";
		Serial.print(CV.readBusPower(), 5);
		Serial.println(" W";

		Serial.print("Curent Draw: ";
		Serial.print(CV.readShuntCurrent(), 5);
		Serial.println(" A";
		delay(1000);
		
		//Serial.println(analogRead(A1)*5.0/1023);*/
	}
   return(0);

}
